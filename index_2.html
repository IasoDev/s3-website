<!DOCTYPE html>
<html>
<head>
	<style>
table {
    font-family: arial, sans-serif;
    border-collapse: collapse;
    width: 100%;
}

td, th {
    border: 1px solid #dddddd;
    text-align: left;
    padding: 8px;
}

tr:nth-child(even) {
    background-color: #dddddd;
}
</style>
</head>
<body style="text-align:center">
	<h1>Request Information</h1>

<table>
    <tr>
        <th>Prioritaet</th>
        <th>Anfrageinhalt</th>
        <th>Raumnummer</th>
        <th>Name</th>
        <th>Zeitpunkt der Anfrage</th>
    </tr>
    <tr>
        <td>1</td>
        <td>Notfall</td>
        <td>110</td>
        <td>Simone Morge</td>
        <td>10.40</td>
    </tr>
    <tr>
        <td>2</td>
        <td>Toilettengang</td>
        <td>103</td>
        <td>Harald Gerold</td>
        <td>10.30</td>
    </tr> 
    <tr>
        <td>3</td>
        <td>Hilfe mit Fernseher</td>
        <td>103</td>
        <td>Kerstin Fischer</td>
        <td>10.45</td>
    </tr>       
</table> 

<script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/3.3.3/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tabulator/3.3.3/js/tabulator.min.js"></script>

var createCORSRequest = function(method, url) {
	var xhr = new XMLHttpRequest();
	if ("withCredentials" in xhr) {
		// Most browsers.
		xhr.open(method, url, true);
	} else if (typeof XDomainRequest != "undefined") {
		// IE8 & IE9
		xhr = new XDomainRequest();
		xhr.open(method, url);
	} else {
		// CORS not supported.
		xhr = null;
	}
	return xhr;
};

var loadXMLDoc = function(autoRefresh){
	var width = 600,
    	barHeight = 50,
		padding = 60;
	
	var url = 'data.json';
	var method = 'GET';
	var xhr = createCORSRequest(method, url);

	xhr.onload = function(req) {	  
		  var data = JSON.parse(this.responseText).Items;
		  
		  data = data.sort((a,b) => b.tally - a.tally);
		  
		  var x = d3.scaleLinear()
		      .domain([0, d3.max(data, function(d) { return d.tally + padding; })])
		      .range([0, width]);
		  
		  var chart = d3.select(".chart")
		      .attr("width", width)
		      .attr("height", barHeight * data.length);
			  
		  chart.selectAll("*").remove()

		  var bar = chart.selectAll("g")
		      .data(data)
		    .enter().append("g")
		      .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });
		  
		  bar.append("rect")
		      .attr("width",  function(d) { return x(d.tally) + padding; })
		      .attr("height", barHeight - 1);

		  bar.append("text")
		      .attr("x", function(d) { return x(d.tally) + padding - 3; })
		      .attr("y", barHeight / 2)
		      .attr("dy", ".35em")
		      .text(function(d) { return d.candidate + ': ' + d.tally; });
		  
	};

	xhr.onerror = function() {
	  // Error code goes here.
	};

  	xhr.send();
	
	//AutoRefresh
	if(autoRefresh){
		window.setTimeout(loadXMLDoc, 3000, true);
	}
}


function hideForm(){
	d3.select("form")
		.style("display", "none");
	d3.select(".thanks")
		.style("display", "block");
	window.setTimeout(loadXMLDoc, 1200, false);
}

loadXMLDoc(true);    
    

</script>       
</body>
</html>